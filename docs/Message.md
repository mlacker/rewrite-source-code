# MQ

## 推拉模式

### 推模式

消息从 Broker 主动推送到 Consumer

优点：

- 实时性

缺点：

- 推送速率难以匹配消费速率，无法感知 consumer 消费能力
- 无法根据消费者负载能力均衡

优化：

- 采用令牌投递的方式控制消费速率，即线程处理完一个请求空闲时则生成一块令牌。

### 拉模式

Consumer 主动向 Broker 获取消息，并维护游标指针等信息

优点：

- 根据自身的负载能力获取消息
- 可以批量获取消息

缺点：

- 缺乏实时性，不知道什么时候有新得消息
- 设置间隔较大，会产生较大的延迟
- 拉取频率过长容易造成消息堆积
- 拉取间隔过短容易产生大量的无效请求
- 当没有消息的时候，无效的空轮询

优化：

- 长轮询

## 其它

- 如何保证消费消息的有序性？
  相关的消息分片到相同的节点处理，节点建立缓冲区，按序处理消息。如果前序消息未到达则进入等待状态，超时则丢弃消息。
- 相同分区的顺序？
